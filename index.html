<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gym Coaching ‚Äî Startup Architecture</title>

<style>
body{margin:0;font-family:system-ui;background:#0f172a;color:white}
.hidden{display:none}
.center{height:100vh;display:flex;justify-content:center;align-items:center}
.card{background:#1e293b;padding:20px;border-radius:12px;margin:12px}
.sidebar{position:fixed;width:220px;height:100vh;background:#020617;padding:20px}
.main{margin-left:240px;padding:30px}
button,input{width:100%;padding:10px;margin-top:8px;border:none;border-radius:6px}
button{background:#22c55e;color:white;cursor:pointer}
.rank{display:flex;justify-content:space-between;padding:6px 0}
</style>
</head>

<body>

<!-- AUTH -->
<div id="auth" class="center">
<div class="card">
<h2>Gym Coaching</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="register()">Register</button>
</div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<aside class="sidebar">
<h2>üèã System</h2>
<button onclick="nav('dashboard')">Dashboard</button>
<button onclick="nav('leaderboard')">Leaderboard</button>
<button onclick="logout()">Logout</button>
</aside>

<main class="main">

<section id="dashboard">
<h1 id="welcome"></h1>

<div class="card">
<h3>Total Score</h3>
<h2 id="score">0</h2>
<button onclick="recordWorkout()">Complete Workout</button>
</div>
</section>

<section id="leaderboard" class="hidden">
<div class="card">
<h2>Global Leaderboard</h2>
<div id="leaderboard"></div>
</div>
</section>

</main>
</div>

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getAuth,
signInWithEmailAndPassword,
createUserWithEmailAndPassword,
signOut,
onAuthStateChanged
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import {
getFirestore,
doc,
getDoc,
setDoc,
updateDoc,
collection,
addDoc,
query,
orderBy,
limit,
getDocs,
serverTimestamp
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ---------- INIT ---------- */

const firebaseConfig={
apiKey:"AIzaSyCssNzQ3FeQ4reaEQTzGgpVbp9Igahn-KA",
authDomain:"gym-coaching-app.firebaseapp.com",
projectId:"gym-coaching-app",
storageBucket:"gym-coaching-app.firebasestorage.app",
messagingSenderId:"924789843595",
appId:"1:924789843595:web:08e2d7e588123bc407168e"
};

const appFirebase=initializeApp(firebaseConfig);
const auth=getAuth(appFirebase);
const db=getFirestore(appFirebase);

let uid;
let stats={score:0};

/* ---------- NAV ---------- */

window.nav=(p)=>{
document.querySelectorAll("section")
.forEach(s=>s.classList.add("hidden"));
document.getElementById(p).classList.remove("hidden");
};

/* ---------- AUTH ---------- */

window.login=()=>signInWithEmailAndPassword(auth,email.value,password.value);
window.register=()=>createUserWithEmailAndPassword(auth,email.value,password.value);
window.logout=()=>signOut(auth);

/* ---------- SESSION ---------- */

onAuthStateChanged(auth, async(user)=>{

if(!user){
auth.style.display="flex";
app.classList.add("hidden");
return;
}

auth.style.display="none";
app.classList.remove("hidden");

uid=user.uid;
welcome.innerText="Welcome "+user.email;

const ref=doc(db,"users",uid);
const snap=await getDoc(ref);

if(!snap.exists()){
await setDoc(ref,{score:0});
}else{
stats=snap.data();
}

render();
loadLeaderboard();
});

/* ---------- EVENT SYSTEM ---------- */

window.recordWorkout=async()=>{

// EVENT WRITE (append-only)
await addDoc(collection(db,"workout_events"),{
userId:uid,
type:"WORKOUT_COMPLETED",
scoreGain:10,
createdAt:serverTimestamp()
});

// AGGREGATE UPDATE
stats.score+=10;

await updateDoc(doc(db,"users",uid),stats);

render();
loadLeaderboard();
};

/* ---------- UI ---------- */

function render(){
score.innerText=stats.score;
}

/* ---------- LEADERBOARD ---------- */

async function loadLeaderboard(){

leaderboard.innerHTML="Loading...";

const q=query(
collection(db,"users"),
orderBy("score","desc"),
limit(10)
);

const snap=await getDocs(q);

leaderboard.innerHTML="";

let i=1;

snap.forEach(d=>{
leaderboard.innerHTML+=`
<div class="rank">
<span>#${i++}</span>
<span>${d.data().score}</span>
</div>`;
});
}

</script>

</body>
</html>
