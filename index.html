<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gym Coaching FAANG Demo</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:system-ui;
background:#0f172a;
color:white;
}

.light{
background:#f1f5f9;
color:#111;
}

.hidden{display:none}

.center{
height:100vh;
display:flex;
justify-content:center;
align-items:center;
}

.card{
background:#1e293b;
padding:20px;
border-radius:12px;
margin-bottom:20px;
}

.light .card{background:white;}

input,button{
width:100%;
padding:10px;
margin-top:8px;
border:none;
border-radius:6px;
}

button{
background:#22c55e;
color:white;
cursor:pointer;
}

.sidebar{
position:fixed;
width:230px;
height:100vh;
background:#020617;
padding:20px;
}

.main{
margin-left:250px;
padding:30px;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
gap:20px;
}

.rank{
display:flex;
justify-content:space-between;
padding:6px 0;
border-bottom:1px solid #334155;
}
</style>
</head>

<body>

<!-- AUTH -->
<div id="auth" class="center">
<div class="card">
<h2>Gym Coaching Pro</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="loginUser()">Login</button>
<button onclick="registerUser()">Register</button>
</div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<aside class="sidebar">
<h2>üèã Gym</h2>
<button onclick="showPage('dashboard')">Dashboard</button>
<button onclick="showPage('analytics')">Analytics</button>
<button onclick="showPage('leaderboard')">Leaderboard</button>
<button onclick="toggleTheme()">Theme</button>
<button onclick="logoutUser()">Logout</button>
</aside>

<main class="main">

<section id="dashboard">
<h1 id="welcome"></h1>

<div class="grid">

<div class="card">
<h3>Calories</h3>
<h2 id="calories">0</h2>
<button onclick="addCalories()">+250</button>
</div>

<div class="card">
<h3>Protein</h3>
<h2 id="protein">0g</h2>
<button onclick="addProtein()">+30g</button>
</div>

<div class="card">
<h3>Workout Score</h3>
<h2 id="score">0</h2>
<button onclick="addWorkout()">Workout Done</button>
</div>

</div>
</section>

<section id="analytics" class="hidden">
<div class="card">
<canvas id="chartCanvas"></canvas>
</div>
</section>

<section id="leaderboard" class="hidden">
<div class="card">
<h2>üèÜ Global Leaderboard</h2>
<div id="leaderboardList"></div>
</div>
</section>

</main>
</div>

<script type="module">

/* ---------- FIREBASE ---------- */

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
getAuth,
signInWithEmailAndPassword,
createUserWithEmailAndPassword,
signOut,
onAuthStateChanged
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import {
getFirestore,
doc,
getDoc,
setDoc,
updateDoc,
collection,
getDocs,
query,
orderBy,
limit
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCssNzQ3FeQ4reaEQTzGgpVbp9Igahn-KA",
authDomain:"gym-coaching-app.firebaseapp.com",
projectId:"gym-coaching-app",
storageBucket:"gym-coaching-app.firebasestorage.app",
messagingSenderId:"924789843595",
appId:"1:924789843595:web:08e2d7e588123bc407168e"
};

const appFirebase=initializeApp(firebaseConfig);
const auth=getAuth(appFirebase);
const db=getFirestore(appFirebase);

/* ---------- STATE ---------- */

let userRef;
let data={
calories:0,
protein:0,
score:0,
history:[],
theme:"dark"
};

/* ---------- NAV ---------- */

window.showPage=(p)=>{
document.querySelectorAll("main section")
.forEach(s=>s.classList.add("hidden"));
document.getElementById(p).classList.remove("hidden");
};

/* ---------- AUTH ---------- */

window.loginUser=()=>signInWithEmailAndPassword(auth,email.value,password.value);
window.registerUser=()=>createUserWithEmailAndPassword(auth,email.value,password.value);
window.logoutUser=()=>signOut(auth);

/* ---------- SESSION ---------- */

onAuthStateChanged(auth, async(user)=>{

if(!user){
auth.style.display="flex";
app.classList.add("hidden");
return;
}

auth.style.display="none";
app.classList.remove("hidden");

welcome.innerText="Welcome "+user.email;

userRef=doc(db,"users",user.uid);

const snap=await getDoc(userRef);

if(!snap.exists()){
await setDoc(userRef,data);
}else{
data=snap.data();
}

applyTheme();
render();
createChart();
loadLeaderboard();
});

/* ---------- SAVE ---------- */

async function save(){
await updateDoc(userRef,data);
render();
updateChart();
loadLeaderboard();
}

/* ---------- ACTIONS ---------- */

window.addCalories=()=>{data.calories+=250;save();}
window.addProtein=()=>{data.protein+=30;save();}

window.addWorkout=()=>{
data.score+=10;
data.history.push(data.score);
save();
};

/* ---------- THEME ---------- */

window.toggleTheme=()=>{
data.theme=data.theme==="dark"?"light":"dark";
applyTheme();
save();
};

function applyTheme(){
document.body.classList.toggle("light",data.theme==="light");
}

/* ---------- UI ---------- */

function render(){
calories.innerText=data.calories;
protein.innerText=data.protein+"g";
score.innerText=data.score;
}

/* ---------- CHART ---------- */

let chart;

function createChart(){
chart=new Chart(chartCanvas,{
type:"line",
data:{
labels:data.history.map((_,i)=>"Session "+(i+1)),
datasets:[{
data:data.history,
borderColor:"#22c55e"
}]
}
});
}

function updateChart(){
chart.data.labels=data.history.map((_,i)=>"Session "+(i+1));
chart.data.datasets[0].data=data.history;
chart.update();
}

/* ---------- LEADERBOARD ---------- */

async function loadLeaderboard(){

leaderboardList.innerHTML="Loading...";

const q=query(
collection(db,"users"),
orderBy("score","desc"),
limit(10)
);

const snap=await getDocs(q);

leaderboardList.innerHTML="";

snap.forEach((doc,i)=>{
const user=doc.data();

leaderboardList.innerHTML+=`
<div class="rank">
<span>#${i+1}</span>
<span>${user.score || 0} pts</span>
</div>`;
});
}

</script>

</body>
</html>
